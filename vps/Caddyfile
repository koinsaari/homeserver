{
    email {$ACME_EMAIL}
}

auth.{$DOMAIN} {
    reverse_proxy authelia:9091
}

netbird.{$DOMAIN} {
    # Native gRPC (needs HTTP/2 cleartext to backend)
    @grpc header Content-Type application/grpc*
    reverse_proxy @grpc h2c://netbird-server:80

    # Combined server paths (relay, signal, management, OAuth2)
    @backend path /relay* /ws-proxy/* /api/* /oauth2/*
    reverse_proxy @backend netbird-server:80

    # Dashboard
    forward_auth authelia:9091 {
        uri /api/authz/forward-auth
        copy_headers Remote-User Remote-Groups Remote-Email Remote-Name
    }
    reverse_proxy /* netbird-dashboard:80
}

ntfy.{$DOMAIN} {
    reverse_proxy ntfy:8082
}

molly.{$DOMAIN} {
    reverse_proxy mollysocket:8091
}